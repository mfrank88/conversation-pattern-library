<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grace Conversation Pattern Library</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #005587;
            --secondary: #0075b3;
            --accent: #4da6d4;
            --light-bg: #f4f8fb;
            --white: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #5a5a5a;
            --border: #d9e8f2;
            --shadow: rgba(0, 85, 135, 0.08);
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, var(--light-bg) 0%, #ffffff 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        header {
            margin-bottom: 4rem;
            border-bottom: 2px solid var(--border);
            padding-bottom: 2rem;
        }

        h1 {
            font-family: 'Roboto', sans-serif;
            font-size: 3.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
            font-weight: 100;
            letter-spacing: -0.02em;
        }

        .subtitle {
            font-size: 1.125rem;
            color: var(--text-secondary);
            font-weight: 300;
        }

        .search-container {
            margin-bottom: 3rem;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: 'Roboto', sans-serif;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .pattern-card {
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .pattern-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px var(--shadow);
            border-color: var(--secondary);
        }

        .pattern-header {
            padding: 2rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--white);
        }

        .pattern-title {
            font-family: 'Roboto', sans-serif;
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
            font-weight: 300;
        }

        .pattern-meta {
            font-size: 0.875rem;
            opacity: 0.9;
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pattern-preview {
            padding: 2rem;
        }

        .pattern-description {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.7;
        }

        .tag-container {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tag {
            padding: 0.375rem 0.875rem;
            background: var(--light-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 0.8125rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .expand-button {
            margin-top: 1.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--accent);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-family: 'Roboto', sans-serif;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .expand-button:hover {
            background: var(--secondary);
            transform: scale(1.02);
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .modal-content {
            background: var(--white);
            border-radius: 20px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 2.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--white);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-title {
            font-family: 'Roboto', sans-serif;
            font-size: 2.25rem;
            margin-bottom: 0.5rem;
            font-weight: 300;
        }

        .modal-body {
            padding: 2.5rem;
        }

        .section {
            margin-bottom: 2.5rem;
        }

        .section-title {
            font-family: 'Roboto', sans-serif;
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
            font-weight: 300;
        }

        .flow-step {
            background: var(--light-bg);
            border-left: 4px solid var(--accent);
            padding: 1.25rem 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
        }

        .flow-step-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .dialogue {
            background: #ffffff;
            border: 1px solid var(--border);
            padding: 1rem;
            border-radius: 8px;
            margin: 0.75rem 0;
            font-family: 'Roboto', sans-serif;
        }

        .dialogue-label {
            font-weight: 600;
            font-size: 0.8125rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--secondary);
            margin-bottom: 0.5rem;
        }

        .edge-case {
            background: #fffef7;
            border: 2px solid #f4e8c1;
            padding: 1.25rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .edge-case-title {
            font-weight: 600;
            color: #8b6914;
            margin-bottom: 0.5rem;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .metric-box {
            background: var(--light-bg);
            border: 1px solid var(--border);
            padding: 1.25rem;
            border-radius: 8px;
            text-align: center;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 300;
            color: var(--primary);
            font-family: 'Roboto', sans-serif;
        }

        .metric-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .close-button {
            position: absolute;
            top: 2rem;
            right: 2rem;
            width: 40px;
            height: 40px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: var(--white);
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        ul {
            margin-left: 1.5rem;
            margin-top: 0.5rem;
        }

        li {
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .no-results {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .no-results-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Conversation Pattern Library</h1>
            <p class="subtitle">Core conversational flows for AI-powered healthcare appointment management</p>
        </header>

        <div class="search-container">
            <input 
                type="text" 
                class="search-input" 
                id="searchInput" 
                placeholder="Search patterns by name, use case, or keyword..."
            >
        </div>

        <div class="pattern-grid" id="patternGrid">
            <!-- Verification Pattern -->
            <div class="pattern-card" data-pattern="verification" data-keywords="verify appointment check confirm DOB identity lookup">
                <div class="pattern-header">
                    <h2 class="pattern-title">Grace: Appointment Verification</h2>
                    <div class="pattern-meta">
                        <div class="meta-item">
                            <span>üìû</span>
                            <span>First Contact Flow</span>
                        </div>
                        <div class="meta-item">
                            <span>‚è±Ô∏è</span>
                            <span>~2 min avg</span>
                        </div>
                    </div>
                </div>
                <div class="pattern-preview">
                    <p class="pattern-description">
                        The foundational flow for confirming appointment details. Uses DOB + phone number verification to locate patient records and provide appointment information.
                    </p>
                    <div class="tag-container">
                        <span class="tag">Identity Verification</span>
                        <span class="tag">HIPAA Compliant</span>
                        <span class="tag">SMS Delivery</span>
                    </div>
                    <button class="expand-button" onclick="showPattern('verification')">View Full Pattern ‚Üí</button>
                </div>
            </div>

            <!-- Cancellation Pattern -->
            <div class="pattern-card" data-pattern="cancellation" data-keywords="cancel appointment delete remove cancellation multiple">
                <div class="pattern-header">
                    <h2 class="pattern-title">Grace: Appointment Cancellation</h2>
                    <div class="pattern-meta">
                        <div class="meta-item">
                            <span>üóëÔ∏è</span>
                            <span>Task Completion</span>
                        </div>
                        <div class="meta-item">
                            <span>‚è±Ô∏è</span>
                            <span>~1.5 min avg</span>
                        </div>
                    </div>
                </div>
                <div class="pattern-preview">
                    <p class="pattern-description">
                        Handles appointment cancellation requests with built-in safeguards for multiple appointments, cancellation windows, and rescheduling offers.
                    </p>
                    <div class="tag-container">
                        <span class="tag">Multi-Appointment Handling</span>
                        <span class="tag">Deflection to Reschedule</span>
                        <span class="tag">Confirmation Required</span>
                    </div>
                    <button class="expand-button" onclick="showPattern('cancellation')">View Full Pattern ‚Üí</button>
                </div>
            </div>

            <!-- Reschedule Pattern -->
            <div class="pattern-card" data-pattern="reschedule" data-keywords="reschedule change move appointment 3-strike availability preference">
                <div class="pattern-header">
                    <h2 class="pattern-title">Grace: Appointment Rescheduling</h2>
                    <div class="pattern-meta">
                        <div class="meta-item">
                            <span>üîÑ</span>
                            <span>Multi-Turn Flow</span>
                        </div>
                        <div class="meta-item">
                            <span>‚è±Ô∏è</span>
                            <span>~3-5 min avg</span>
                        </div>
                    </div>
                </div>
                <div class="pattern-preview">
                    <p class="pattern-description">
                        Complex negotiation flow using the "3-Strike Rule" to find available appointment slots based on patient preferences while maintaining scope constraints.
                    </p>
                    <div class="tag-container">
                        <span class="tag">3-Strike Negotiation</span>
                        <span class="tag">Scope Verification</span>
                        <span class="tag">Preference Learning</span>
                        <span class="tag">Digital Deflection</span>
                    </div>
                    <button class="expand-button" onclick="showPattern('reschedule')">View Full Pattern ‚Üí</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <button class="close-button" onclick="closeModal()">√ó</button>
                <h2 class="modal-title" id="modalTitle"></h2>
                <p id="modalSubtitle"></p>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content loaded dynamically -->
            </div>
        </div>
    </div>

    <script>
        const patterns = {
            verification: {
                title: 'Grace: Appointment Verification Flow',
                subtitle: 'Core identity verification and appointment lookup pattern',
                content: `
                    <div class="section">
                        <h3 class="section-title">Scenario</h3>
                        <p>Caller wants to verify details of an upcoming appointment.</p>
                    </div>

                    <div class="section">
                        <h3 class="section-title">Happy Path</h3>
                        
                        <div class="flow-step">
                            <div class="flow-step-title">Step 1: Greeting & Disclosure</div>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "Hello, this is Grace, an AI-powered assistant. I'm still developing my skills, so I appreciate your patience as we work together. I can help with information about an existing appointment or cancellation. What can I assist with today?"
                            </div>
                        </div>

                        <div class="flow-step">
                            <div class="flow-step-title">Step 2: Intent Recognition</div>
                            <p><strong>Trigger phrases:</strong></p>
                            <ul>
                                <li>"I want to check on my appointment"</li>
                                <li>"Can you tell me when my appointment is"</li>
                                <li>"I need to verify my appointment"</li>
                                <li>"What time is my appointment"</li>
                            </ul>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "Sure, let me look up the upcoming appointment."
                            </div>
                            <p><em>System uses DOB (from IVR handoff) + Caller ANI to locate patient record and appointments</em></p>
                        </div>

                        <div class="flow-step">
                            <div class="flow-step-title">Step 3: Appointment Lookup</div>
                            <p><strong>If single appointment found:</strong></p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "There's an appointment on [Day, Date] at [Time] with [Provider Name] at [Facility Name], located at [Address]. Would a text message with these details be helpful?"
                            </div>
                            
                            <p><strong>If multiple appointments found:</strong></p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "There are multiple upcoming appointments. The first is on [Date/Time] with [Provider]. The next is on [Date/Time] with [Provider]. Which one is this call about?"
                            </div>
                        </div>

                        <div class="flow-step">
                            <div class="flow-step-title">Step 4: SMS Offer & Closing</div>
                            <div class="dialogue">
                                <div class="dialogue-label">If caller accepts SMS</div>
                                "A text with the appointment details and office address is on its way. Is there anything else?"
                            </div>
                            <div class="dialogue">
                                <div class="dialogue-label">If caller declines SMS</div>
                                "No problem. Is there anything else that's needed today?"
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">Key Edge Cases</h3>
                        
                        <div class="edge-case">
                            <div class="edge-case-title">External Communications Reference</div>
                            <p><strong>Trigger:</strong> Caller references receiving a text/email/letter about an appointment Grace cannot locate</p>
                            <p><strong>Grace's response:</strong> Must distinguish between "verify this appointment exists" (Grace can attempt) vs. "explain why I got this communication" (Grace must escalate)</p>
                            <ul>
                                <li>If verification request ‚Üí Attempt lookup within date constraints</li>
                                <li>If "why" question ‚Üí Acknowledge limitation and offer Care Navigator transfer</li>
                            </ul>
                        </div>

                        <div class="edge-case">
                            <div class="edge-case-title">No Appointments Found</div>
                            <p><strong>Handling:</strong></p>
                            <ul>
                                <li>Grace acknowledges: "The appointment mentioned isn't showing in the system."</li>
                                <li>Grace offers to check: "Is the appointment possibly under a different name or phone number?"</li>
                                <li>If still not found after one clarification attempt ‚Üí Escalate to Care Navigator</li>
                            </ul>
                        </div>

                        <div class="edge-case">
                            <div class="edge-case-title">Past Appointment Reference</div>
                            <p><strong>Constraint:</strong> Grace can only see today and future appointments</p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "That date has already passed. Appointment information is available for today and future dates only. If there's concern about that notification, a Care Navigator can help clarify. Would a transfer be helpful?"
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">Performance Metrics</h3>
                        <div class="metrics">
                            <div class="metric-box">
                                <div class="metric-value">~2 min</div>
                                <div class="metric-label">Avg Call Duration</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-value">85%+</div>
                                <div class="metric-label">Completion Rate</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-value">High</div>
                                <div class="metric-label">Patient Trust</div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">Implementation Notes</h3>
                        <ul>
                            <li><strong>Verification Method:</strong> DOB received from IVR handoff + Caller ANI (phone number)</li>
                            <li><strong>Data Visibility:</strong> Today's appointments and future only (no past appointments)</li>
                            <li><strong>Compliance:</strong> HIPAA-compliant identity verification completed by IVR before Grace handoff</li>
                            <li><strong>Escalation Trigger:</strong> Appointment not found after lookup attempts</li>
                        </ul>
                    </div>
                `
            },
            cancellation: {
                title: 'Grace: Appointment Cancellation Flow',
                subtitle: 'Task-based cancellation with safeguards and rescheduling offers',
                content: `
                    <div class="section">
                        <h3 class="section-title">Scenario</h3>
                        <p>Caller wants to cancel an existing appointment. Grace must confirm which appointment, verify cancellation is possible, offer rescheduling as an alternative, and complete the cancellation with confirmation.</p>
                    </div>

                    <div class="section">
                        <h3 class="section-title">Happy Path</h3>
                        
                        <div class="flow-step">
                            <div class="flow-step-title">Step 1: Intent Recognition</div>
                            <p><strong>Trigger phrases:</strong></p>
                            <ul>
                                <li>"I need to cancel my appointment"</li>
                                <li>"Can you cancel my appointment"</li>
                                <li>"I can't make it"</li>
                            </ul>
                        </div>

                        <div class="flow-step">
                            <div class="flow-step-title">Step 2: Appointment Identification</div>
                            <p><strong>If single appointment:</strong></p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "I see an appointment on [Date] at [Time] with [Provider]. Is this the appointment to cancel?"
                            </div>
                            
                            <p><strong>If multiple appointments:</strong></p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "There are multiple upcoming appointments. One is on [Date] with [Provider], and another on [Date] with [Provider]. Which appointment should be cancelled?"
                            </div>
                        </div>

                        <div class="flow-step">
                            <div class="flow-step-title">Step 3: Rescheduling Offer (Deflection)</div>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "Before canceling, would rescheduling to a different day or time work instead?"
                            </div>
                            <ul>
                                <li><strong>If yes:</strong> Transition to Reschedule Flow</li>
                                <li><strong>If no:</strong> Proceed to cancellation</li>
                            </ul>
                        </div>

                        <div class="flow-step">
                            <div class="flow-step-title">Step 4: Cancellation Window Check</div>
                            <p><strong>If within cancellation window:</strong> Proceed to Step 5</p>
                            <p><strong>If past cancellation window:</strong></p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "This appointment can no longer be cancelled. A Care Navigator can provide more information. Would a transfer be helpful?"
                            </div>
                        </div>

                        <div class="flow-step">
                            <div class="flow-step-title">Step 5: Confirmation & Completion</div>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "The appointment on [Date] at [Time] with [Provider] has been cancelled. Would a text confirmation be helpful?"
                            </div>
                            <p>If SMS accepted ‚Üí Send confirmation text</p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace (closing)</div>
                                "Is there anything else needed today?"
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">Key Edge Cases</h3>
                        
                        <div class="edge-case">
                            <div class="edge-case-title">Multiple Appointment Cancellation</div>
                            <p><strong>Trigger:</strong> Caller wants to cancel more than one appointment</p>
                            <p><strong>Handling:</strong> Grace processes one appointment at a time</p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "Let's cancel the first appointment on [Date]. [Process cancellation]. Now, regarding the second appointment on [Date]..."
                            </div>
                        </div>

                        <div class="edge-case">
                            <div class="edge-case-title">Caller Changes Mind During Flow</div>
                            <p><strong>Trigger:</strong> Caller initially says "cancel" then switches to "actually, I want to reschedule"</p>
                            <p><strong>Handling:</strong> Acknowledge gracefully and pivot</p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "Understood ‚Äî let's look at rescheduling instead."
                            </div>
                            <p>‚Üí Transition to Reschedule Flow</p>
                        </div>

                        <div class="edge-case">
                            <div class="edge-case-title">System Error During Cancellation</div>
                            <p><strong>Handling:</strong> Do not attempt multiple retries</p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "There's a system issue preventing the cancellation from completing. A Care Navigator can assist. Transferring now."
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">Design Principles</h3>
                        <ul>
                            <li><strong>Always offer rescheduling before canceling</strong> ‚Äî reduces patient dropout and optimizes care continuity</li>
                            <li><strong>One appointment at a time</strong> ‚Äî prevents confusion and system errors</li>
                            <li><strong>Clear confirmation language</strong> ‚Äî avoid corporate speak like "cancellation criteria"</li>
                            <li><strong>Minimize friction</strong> ‚Äî simple yes/no decisions, no unnecessary verification loops</li>
                        </ul>
                    </div>

                    <div class="section">
                        <h3 class="section-title">Performance Metrics</h3>
                        <div class="metrics">
                            <div class="metric-box">
                                <div class="metric-value">~1.5 min</div>
                                <div class="metric-label">Avg Call Duration</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-value">~30%</div>
                                <div class="metric-label">Deflected to Reschedule</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-value">90%+</div>
                                <div class="metric-label">Successful Completion</div>
                            </div>
                        </div>
                    </div>
                `
            },
            reschedule: {
                title: 'Grace: Appointment Rescheduling Flow',
                subtitle: 'Multi-turn negotiation using 3-Strike Rule',
                content: `
                    <div class="section">
                        <h3 class="section-title">Scenario</h3>
                        <p>Caller wants to reschedule an existing appointment. This is the most complex flow, requiring context maintenance across 8-10 conversational turns while negotiating availability within scope constraints.</p>
                    </div>

                    <div class="section">
                        <h3 class="section-title">Scope Constraints</h3>
                        <div class="flow-step">
                            <div class="flow-step-title">In-Scope (Grace Can Handle)</div>
                            <ul>
                                <li>Same provider</li>
                                <li>Same facility</li>
                                <li>Different date/time only</li>
                            </ul>
                        </div>
                        <div class="flow-step">
                            <div class="flow-step-title">Out-of-Scope (Requires Escalation)</div>
                            <ul>
                                <li>Different provider</li>
                                <li>Different facility</li>
                                <li>Complex scheduling logic</li>
                            </ul>
                            <p><strong>Mitigation:</strong> Offer SMS link to digital self-service OR escalate to Care Navigator</p>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">The 3-Strike Rule</h3>
                        <p>Grace has <strong>3 attempts</strong> to find an acceptable appointment slot before escalating to digital self-service or Care Navigator.</p>
                        
                        <div class="flow-step">
                            <div class="flow-step-title">Strike 1: Proactive Offer (Next Available)</div>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "The next opening with [Provider Name] is [Day, Date] at [Time]. Does that work?"
                            </div>
                            <p><strong>If accepted:</strong> ‚Üí Proceed to Resolution</p>
                            <p><strong>If declined:</strong> ‚Üí Move to Strike 2</p>
                        </div>

                        <div class="flow-step">
                            <div class="flow-step-title">Strike 2: Preference Pivot</div>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "Is there a day of the week or time of day that works better?"
                            </div>
                            <p><strong>Examples:</strong> "Wednesdays," "mornings," "afternoons," "Fridays after 2pm"</p>
                            <p>Grace retains this preference and searches accordingly ‚Üí Strike 3</p>
                        </div>

                        <div class="flow-step">
                            <div class="flow-step-title">Strike 3: Targeted Offer Based on Preference</div>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace (based on "Wednesdays" preference)</div>
                                "There's a Wednesday opening on [Date] at [Time]. Would that work?"
                            </div>
                            <p><strong>If accepted:</strong> ‚Üí Proceed to Resolution</p>
                            <p><strong>If declined:</strong> ‚Üí 3 Strikes Failed (escalation path)</p>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">Full Happy Path</h3>
                        
                        <div class="flow-step">
                            <div class="flow-step-title">Phase 1: Intent & Verification</div>
                            <div class="dialogue">
                                <div class="dialogue-label">User</div>
                                "I need to change my upcoming appointment."
                            </div>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "Let me pull up the details."
                            </div>
                            <p><em>[Grace retrieves appointment info]</em></p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace (single appointment)</div>
                                "There's an appointment scheduled with [Provider] at [Facility] on [Day, Date] at [Time]. Is this the one that needs to be rescheduled?"
                            </div>
                        </div>

                        <div class="flow-step">
                            <div class="flow-step-title">Phase 2: Scope Constraint Check</div>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "Just to confirm ‚Äî is the goal to see [Provider Name] at the same location, just on a different day or time?"
                            </div>
                            <ul>
                                <li><strong>If YES:</strong> Proceed to Phase 3 (Availability Negotiation)</li>
                                <li><strong>If NO:</strong> ‚Üí Out-of-Scope Handling</li>
                            </ul>
                        </div>

                        <div class="flow-step">
                            <div class="flow-step-title">Phase 3: Availability Negotiation (3-Strike Rule)</div>
                            <p>See detailed Strike 1 ‚Üí Strike 2 ‚Üí Strike 3 flow above</p>
                        </div>

                        <div class="flow-step">
                            <div class="flow-step-title">Phase 4: Resolution & Confirmation</div>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "Got it. The new appointment is confirmed for [Day, Date] at [Time] with [Provider Name] at [Facility]. The previous appointment on [Original Date] has been canceled."
                            </div>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace (SMS offer)</div>
                                "Would a text message with the new appointment details be helpful?"
                            </div>
                            <p><strong>SMS contains:</strong> NEW appointment only (minimizes cognitive load)</p>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">3 Strikes Failed Path</h3>
                        
                        <div class="edge-case">
                            <div class="edge-case-title">When All 3 Offers Are Declined</div>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "Finding the right time is important. There are a couple of options:"
                            </div>
                            
                            <p><strong>Option A: Digital Self-Service</strong></p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "A link to the full calendar for [Provider Name] can be sent by text, so any available slot can be selected directly."
                            </div>
                            
                            <p><strong>Option B: Care Navigator</strong></p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "Or, a Care Navigator can assist with finding a time that works. Which would be better ‚Äî the calendar link or a Care Navigator?"
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">Critical Edge Cases</h3>
                        
                        <div class="edge-case">
                            <div class="edge-case-title">Ambiguous Responses (Not Clear Yes/No)</div>
                            <p><strong>Phrases that indicate hesitation, NOT decline:</strong></p>
                            <ul>
                                <li>"Let me think..."</li>
                                <li>"Let me check my calendar"</li>
                                <li>"Maybe"</li>
                                <li>"I might have to work that day"</li>
                                <li>"What else is there?"</li>
                            </ul>
                            <p><strong>Handling:</strong> These do NOT count as a strike</p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace (after pause)</div>
                                "Take your time. What day or time would work better?"
                            </div>
                        </div>

                        <div class="edge-case">
                            <div class="edge-case-title">Caller Changes Mind Mid-Flow</div>
                            <p><strong>Trigger:</strong> Caller initially confirms same provider/facility, then changes to wanting a different provider</p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "Understood ‚Äî a different provider is needed."
                            </div>
                            <p>‚Üí Redirect to Out-of-Scope Handling (do NOT restart scope check)</p>
                        </div>

                        <div class="edge-case">
                            <div class="edge-case-title">Multiple Appointments to Reschedule</div>
                            <p><strong>Handling:</strong> Grace processes ONE appointment at a time</p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "Let's start with the reschedule for [Appointment 1]."
                            </div>
                            <p>[Complete full reschedule flow]</p>
                            <div class="dialogue">
                                <div class="dialogue-label">Grace</div>
                                "Now, regarding [Appointment 2]..."
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">Implementation Requirements</h3>
                        <ul>
                            <li><strong>Memory/Context Retention:</strong> Must remember caller's stated preference across all 3 strikes</li>
                            <li><strong>Entity Tracking:</strong> Track which slots were offered and declined (no re-offering)</li>
                            <li><strong>Same-Day Logic:</strong> Existing same-day escalation logic applies (no changes needed)</li>
                            <li><strong>Timing:</strong> Keep responses under 5 seconds per turn</li>
                            <li><strong>Language:</strong> Avoid corporate speak; use capability-focused phrasing</li>
                        </ul>
                    </div>

                    <div class="section">
                        <h3 class="section-title">Performance Metrics</h3>
                        <div class="metrics">
                            <div class="metric-box">
                                <div class="metric-value">3-5 min</div>
                                <div class="metric-label">Avg Call Duration</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-value">Strike 1</div>
                                <div class="metric-label">Target Booking</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-value">~40%</div>
                                <div class="metric-label">Digital Deflection</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-value">8-10</div>
                                <div class="metric-label">Avg Turns</div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">Known Product Dependencies</h3>
                        <p><strong>‚ö†Ô∏è Entity/Memory Sharing Issue:</strong> If Grace fails to remember caller's stated preferences ("Wednesdays work best") and offers conflicting slots, this is a trust-breaker.</p>
                        <p><strong>Mitigation:</strong> Fallback escalation if Grace detects context degradation over long calls or off-topic diversions.</p>
                    </div>
                `
            }
        };

        function showPattern(patternId) {
            const pattern = patterns[patternId];
            document.getElementById('modalTitle').textContent = pattern.title;
            document.getElementById('modalSubtitle').textContent = pattern.subtitle;
            document.getElementById('modalBody').innerHTML = pattern.content;
            document.getElementById('modalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(event) {
            if (!event || event.target.id === 'modalOverlay') {
                document.getElementById('modalOverlay').classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const cards = document.querySelectorAll('.pattern-card');
            let visibleCount = 0;

            cards.forEach(card => {
                const keywords = card.dataset.keywords.toLowerCase();
                const title = card.querySelector('.pattern-title').textContent.toLowerCase();
                const description = card.querySelector('.pattern-description').textContent.toLowerCase();
                
                if (keywords.includes(searchTerm) || title.includes(searchTerm) || description.includes(searchTerm)) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            // Show "no results" message if needed
            const grid = document.getElementById('patternGrid');
            let noResults = document.getElementById('noResults');
            
            if (visibleCount === 0 && searchTerm) {
                if (!noResults) {
                    noResults = document.createElement('div');
                    noResults.id = 'noResults';
                    noResults.className = 'no-results';
                    noResults.innerHTML = `
                        <div class="no-results-icon">üîç</div>
                        <p>No patterns found matching "${searchTerm}"</p>
                        <p style="margin-top: 0.5rem; font-size: 0.875rem;">Try searching for verification, cancellation, or reschedule</p>
                    `;
                    grid.appendChild(noResults);
                }
            } else if (noResults) {
                noResults.remove();
            }
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>